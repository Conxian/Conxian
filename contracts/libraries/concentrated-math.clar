;; Math utilities for concentrated liquidity;; Uses fixed-point arithmetic with Q64 precision(define-constant Q64 u18446744073709551616)  ;; 2^64(define-constant MAX_TICK 776363)  ;; Corresponds to sqrt(2^128)(define-constant MIN_TICK (- MAX_TICK))(define-constant TICK_BASE u10000)  ;; 1.0001 in fixed-point with 4 decimals;; Math library contract (to be set by admin)(define-constant MATH_CONTRACT .math-lib-advanced);; Calculate sqrt price from tick using fixed-point arithmetic(define-read-only (tick-to-sqrt-price (tick int))  (let ((math-addr MATH_CONTRACT))    (if (>= tick 0)      (let ((base-power (try! (contract-call? math-addr pow TICK_BASE (to-uint tick)))))        (contract-call? math-addr sqrt base-power))      (let ((base-power (try! (contract-call? math-addr pow TICK_BASE (to-uint (- tick))))))        (let ((sqrt-result (try! (contract-call? math-addr sqrt base-power))))          (ok (/ Q64 sqrt-result))))    )  ));; Calculate tick from sqrt price using fixed-point arithmetic(define-read-only (sqrt-price-to-tick (sqrt-price uint))  (let ((math-addr (var-get math-contract)))    (let ((price-squared (try! (contract-call? math-addr multiply sqrt-price sqrt-price)))          (ratio (/ price-squared Q64))          (log-sqrt (try! (contract-call? math-addr log2 ratio)))          (log-tick-base (try! (contract-call? math-addr log2 TICK_BASE))))      (ok (to-int (/ (* log-sqrt Q64) log-tick-base)))    )  ));; Calculate liquidity amounts for given ticks(define-read-only (get-liquidity-for-amounts (sqrt-price-current uint) (sqrt-price-lower uint) (sqrt-price-upper uint) (amount-x uint) (amount-y uint))  (let (      (liquidity-x (if (<= sqrt-price-current sqrt-price-lower)        u0        (div (mul amount-x sqrt-price-current) (sub sqrt-price-current sqrt-price-lower))      ))      (liquidity-y (if (>= sqrt-price-current sqrt-price-upper)        u0        (div amount-y (sub sqrt-price-upper sqrt-price-current))      ))    )    (if (< sqrt-price-current sqrt-price-upper)      (min liquidity-x liquidity-y)      liquidity-x    )  ));; Fee calculation(define-read-only (calculate-fee (liquidity uint) (fee-rate uint) (time-in-seconds uint))  (div (* liquidity fee-rate time-in-seconds) u1000000))